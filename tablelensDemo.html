<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
<title>Tablelens Demo</title>
<script type="text/javascript" src="d3/d3.js"></script>
<link rel="stylesheet" type="text/css" href="d3/jquery.multiselect.css" />
<link rel="stylesheet" type="text/css" href="d3/style.css" />
<link rel="stylesheet" type="text/css" href="d3/prettify.css" />
<link rel="stylesheet" type="text/css" href="d3/jquery-ui.css" />
<script type="text/javascript" src="d3/jquery.js"></script>
<script type="text/javascript" src="d3/jquery-ui.min.js"></script>
<script type="text/javascript" src="d3/jquery.multiselect.js"></script>
<script type="text/javascript" src="d3/prettify.js"></script>
<script type="text/javascript">
$(function(){
	$("select#multiple_select").multiselect({
		selectedList: 1
	});
	$("select#multiple_select").multiselect({
   		selectedText: function(numChecked, numTotal, checkedItems){
			 ChangeAttr(numChecked,checkedItems);
     		 return numChecked + ' of ' + numTotal + ' checked';
  		 }
	});
	$("select#single_select").multiselect({
		multiple: false,
		header: "Select an filter-option",
		noneSelectedText: "option",
		selectedList: 1
	});
	$("select#single_select").multiselect({
   		selectedText: function(numChecked, numTotal, checkedItems){
			 ChangeColor(checkedItems);
			 return checkedItems[0].value;
  		 }
	});
	$("select#grouping_select").multiselect({
		multiple: false,
		header: "Select an sort-option",
		noneSelectedText: "SortOption",
		selectedList: 2
	});
	$("select#grouping_select").multiselect({
   		selectedText: function(numChecked, numTotal, checkedItems){
			 ChangeSort(checkedItems);
			 return checkedItems[0].value;
  		 }
	});	
});
</script>
<style>
	body{
		text-align:center;
	}
	#outer{
		background:white;
		border-top: 5px solid #69c773;
		margin-left:auto;
		margin-right:auto;
	  	box-shadow: 0 2px 10px rgba(0,0,0,0.8);
	}
	#color_control{
		float:left;
	}
	.select_rect{
 		 fill-opacity: 0.3;
 		 stroke: black;
 		 stroke-width: 1.5px;
	}
	.filter_circle{
		 fill-opacity:0.7;
		 stroke:white;
		 stroke-width:1.5px;
	}
	#inner{
		overflow-y:auto;
		overflow-x:hidden;
		position:relative;
		background:white;
	}
	#AttrButton{
		background:white;
	}
	.attr_button{
		position:relative;
	}
	#control_button{
		margin: auto;
  		position: absolute;
  		top: 0; left: 0; bottom: 0; right: 0;
	}
	#multiple{
		float:left;
	}
	#single{
		float:left;
		position:relative;
	}
	#grouping{
		float:left;
		position:relative;
	}
	#resetSelect{
		margin-top:10px;
		padding-left:30px;
		padding-right:30px;
		float:left;
	}
	#removeselected{
		margin-top:10px;
		padding-left:30px;
		padding-right:30px;
		float:left;
		position:relative;
	}
	#removeothers{
		margin-top:10px;
		float:left;
		padding-left:30px;
		padding-right:30px;
		position:relative;
	}
	#resetfilter{
		margin-top:10px;
		float:left;
		padding-left:30px;
		padding-right:30px;
		position:relative;
	}
	#page-wrapper {
	  width: 1070px;
	  background: #FFF;
	  padding: 1em;
	  margin: 1em auto;
	  text-align :center;
	  min-height: 10px;
	  border-top: 5px solid #69c773;
	  box-shadow: 0 2px 10px rgba(0,0,0,0.8);
	}
	h1 {
		margin-top: 0;
	}
	#file_select{
	}
	img {
	  max-width: 100%;
	}
</style>
</head>
<body>
<div id="page-wrapper">
		<h1>Tablelens Text File Reader</h1>
		<div id="file_select">
			Select a csv file<font color="red" size="2px"><strong>(the file type must be .csv; the attribute must be numerical value)</strong></font>:
			<input type="file" id="fileInput">
		</div>
</div>
<div id = "outer">
	<div id="color_control">
	</div>
	<div id="AttrButton">
	</div>
  	<div id="inner"> 
    </div>
	<div id="control_button">
	<!--***************************************************************-->
	<form id="multiple">
	<select multiple="multiple" id="multiple_select" style="width:100px; top:5px;">
	</select>
	</form>
	<!--****************************************************************-->
	<form id = "grouping">
		<select name="demo" id="grouping_select" style="width:100px; top:5px;">
		</select>
	</form>
	<!--*****************************************************************-->
	<form id = "single">
		<select name="demo" id="single_select" style="width:100px; top:5px;">
		</select>
	</form>
	<button id="resetSelect" onClick="resetSelection();">  Reset Selection  </button>
	<button id="removeselected" onClick="removeSelected();">  Remove Selected  </button>
	<button id="removeothers" onClick="removeOthers();">  Remove Others  </button>
	<button id="resetfilter" onClick="resetfilter();">  Reset Filters  </button>
	</div>
</div>  
</body>
<script type="text/javascript">
	//read data
	var text = new String();
	var stringArray;
	var AttrName = new Array();
	var SelectAttrName = new Array();
	var ColorArray =["uniformly5","uniformly4","uniformly3","percentile1","percentile2"];
	var SortObject = new Object();
	var ManNum = 0;
	//outer rect
	var svgHeight = 550,svgXMin = 120,svgWidth = 1300 - 207,svgXMax,svgYMin = 0,scgYMax;
	var focusXMin = 250, focusXMax = 1205, focusYMin = 100, focusYMax = 700;
	var tableMarginTopY = 30, tableMarginBottomY = 20, tableMarginLeftX = 80, tableMarginRightX = 20;
	var ColorXMin = 150, ColorXMax = 200, ColorYMin = 10, ColorYMax = 580;
	//inner rect
	var InRectXMin = tableMarginLeftX;
	var InRectYMin = tableMarginTopY;
	var InRectWidth = svgWidth - tableMarginLeftX;
	var ButtonInRectWidth = InRectWidth - 10;
	var InRectHeight = svgHeight - tableMarginBottomY - tableMarginTopY;
	var InRectXMax = InRectXMin + InRectWidth;
	var InRectYMax = InRectYMin + InRectHeight;
	var ChangeRectHeight = InRectHeight;
	//inner svg 
	var baseballman = new Array();
	var baseballdata = new Array();
	var render_baseballdata = new Array();
	var AttrArray = new Array();
	var AttrNum = 1, AttrAllNum = 1;
	var DisplayArray = new Array();
	var AttrArray = new Array();
	var AttrAllArray = new Array();
	var TableArray = new Array();
	var ButtonArray = new Array();
	ButtonArray.push("attr1");
	ButtonArray.push("attr2");
	ButtonArray.push("attr3");
	ButtonArray.push("attr4");
	ButtonArray.push("attr5");
	ButtonArray.push("attr6");
	//the number of the people recorded
	var humannum_sum = 322;
	var humannum = 322;
	var humannum_min = 0, humannum_max = 322;
	var svg, svg_color, svg_button;
	var button_width = ButtonInRectWidth/AttrNum;
	var XArray = new Array();
	var YArray = new Array();
	var ScaleArray = new Array();
	var FocusArray = new Array();
	var yfocus_num = 0, focusY_min = -1, focusY_max = -1, top_middleY = 0, bottom_middleY = 0;
	var barheight = 1, focus_height = 20;
	var currentYNum = -1;
	var top_middleY = 0, bottom_middleY = 0;
	var total_event;
	var beginY_index = 0, afterY_index, beginY, afterY, upY_index, RectBeginY, RectMoveY, RectEndY;
	var select_focus = false;
	var baseballman1;
	var text_paddingX = 5, text_paddingY = 5;
	var down_Name = true, down_Bat86 = true, down_Hit86 = true, down_HRuns86 = true, down_Runs86 = true, down_Runbat86 = true, down_all = true;
	var e = d3.rgb(13,2,111);		//red
	var d = d3.rgb(114,99,252);		
	var c = d3.rgb(192,192,192);	//white
	var b = d3.rgb(217,205,62);	
	var a = d3.rgb(220,115,58);		//blue
	var blue = d3.rgb(255,0,0);
	var green = d3.rgb(0,255,0);
	var cs_array = new Array();
	var cs_name = ["cs1","cs2","cs3","cs4","cs5"];
	var cs_coord = new Array();
	cs_array[0] = 0.17;
	cs_array[1] = 0.33;
	cs_array[2] = 0.50;
	cs_array[3] = 0.66;
	cs_array[4] = 0.83;
	for(var i=0;i<cs_array.length;i++){
		cs_coord[i] = InRectYMin + cs_array[i] * InRectHeight;
	}
	var stopNumArray = new Array();
	for(var i=0;i<cs_array.length;i++){
		stopNumArray[i] = cs_array[i] * 100;
	}
	var stopArray = new Array();
	var colorArray = [a,b,c,d,e];
	var minValue = new Array();
	var maxValue = new Array();
	var quarter0Value = new Array();
	var quarter1Value = new Array();
	var quarter2Value = new Array();
	var quarter3Value = new Array();
	var quarter4Value = new Array();
	var minValue = [0,0,0,0,0,0,0];
	var maxValue = [0,0,0,0,0,0,0];
	var filter_array = new Array();
	var filter_name = ["filter1","filter2"];
	filter_array.push(0.00);
	filter_array.push(1.00);
	var selectRectNum = -1;
	var FirstSelectFilterNum = -1, FirstSelectRectNum = -1;
	var moveFilter = false, moveSR = false;
	var filter_coord = new Array();
	filter_coord[0] = InRectYMin + 0.00 * InRectHeight;
	filter_coord[1] = InRectYMin + 1.00 * InRectHeight;
	var sortIndex = 1;
	var middleValue = new Array();
	var NamePArray = new Array();
	var defs, linearGradient;
	button_width = ButtonInRectWidth/AttrNum;
	XArray = new Array();
	var select_option = new Array();
	var filter_option = new Array();
	var former_color, after_color;
	filter_option[0] = "Distributed uniformly with 1/6";
	filter_option[1] = "Distributed uniformly with 1/5";
	filter_option[2] = "Distributed uniformly with 1/4"
	filter_option[3] = "Distribute using 10,50,90";
	filter_option[4] = "Distribute using 25,50,75";
	//*******************************************************************************
	window.onload = function() {
			FocusArray.splice(0,FocusArray.length);
			var fileInput = document.getElementById('fileInput');
			var fileDisplayArea = document.getElementById('fileDisplayArea');
			fileInput.addEventListener('change', function(e) {
				var file = fileInput.files[0];
				var textType = "application/vnd.ms-excel";
				if (file.type == (textType)) {
					var reader = new FileReader();
					reader.onload = function(e) {
						text = reader.result;
						//HandleData(text);
						render_baseballdata.splice(0,render_baseballdata.length);
						minValue.splice(0,minValue.length);
						maxValue.splice(0,maxValue.length);
						stringArray = text.split("\n");
						ManNum = stringArray.length - 1;
						AttrName = stringArray[0].split(",");
						for(var i=0;i<AttrName.length;i++){
							if(AttrName[i].length>5){
								AttrName[i] = AttrName[i].substring(0,5);
							}
						}
						AttrNum = AttrName.length;
						AttrAllNum = AttrName.length;
						var SampleArray = new Array();
						for(var i=0;i<ManNum-1;i++){
							SampleArray = stringArray[i+1].split(",");
							baseballman[i] = new Object();
							for(var j=0;j<AttrName.length;j++){
								baseballman[i][AttrName[j]] = SampleArray[j];
							}
						}
						for(var i=0;i<AttrName.length;i++){
							TableArray[i] = new Array();
							for(var j=0;j<ManNum-1;j++){
								if(i==0){
									TableArray[i][j] = baseballman[j][AttrName[i]];
								}else{
									TableArray[i][j] = parseInt(baseballman[j][AttrName[i]]);
								}
							}
						}
						for(var i=0;i<AttrNum;i++){
							SortObject[AttrName[i]] = true;
						}
						for(var i=0;i<baseballman.length;i++){
							baseballman[i].num = i+1;
						}
						for(var i=0;i<AttrNum;i++){
							DisplayArray[i] = i;
						}
						render_baseballdata = baseballman;
						baseballdata = render_baseballdata;
						sortIndex = 1;
						focus_height = 20;
						humannum_sum = render_baseballdata.length;
						humannum = render_baseballdata.length;
						humannum_min = 0, humannum_max = render_baseballdata.length;
						SortFunction();
						button_width = Math.floor(ButtonInRectWidth/AttrNum);
						for(var i=0;i<humannum_sum;i++){
							YArray[i] = computeCoordY(i);
						}
						for(var i=0;i<=AttrNum;i++){
							AttrAllArray[i] = i;
						}
						for(var i=0;i<AttrAllNum;i++){
							if(i==0){
								minValue[i] = 0;
								maxValue[i] = 0;
							}else{
								minValue[i] = Array.min(TableArray[i]);
								maxValue[i] = Array.max(TableArray[i]);
							}	
						}
						for(var i=0;i<minValue.length;i++){
							var difference = Math.floor((maxValue[i] - minValue[i]));
							quarter0Value[i] = Math.floor(minValue[i] + difference * cs_array[0]);
							quarter1Value[i] = Math.floor(minValue[i] + difference * cs_array[1]);
							quarter2Value[i] = Math.floor(minValue[i] + difference * cs_array[2]);
							quarter3Value[i] = Math.floor(minValue[i] + difference * cs_array[3]);
							quarter4Value[i] = Math.floor(minValue[i] + difference * cs_array[4]);
						}
						for(var i=0;i<AttrAllNum;i++){
							XArray[i] = i * button_width;
						}
						NamePArray.push(quarter4Value[sortIndex]+"");
						NamePArray.push(quarter3Value[sortIndex]+"");
						NamePArray.push(quarter2Value[sortIndex]+"");
						NamePArray.push(quarter1Value[sortIndex]+"");
						NamePArray.push(quarter0Value[sortIndex]+"");
						for(var i=0;i<AttrAllNum;i++){
							middleValue[i] = minValue[sortIndex] + cs_array[i] * (maxValue[sortIndex] - minValue[sortIndex]);
						}
						for(var i=0;i<AttrAllNum;i++){
							ScaleArray[i] = d3.scale.linear()
								.range([0,button_width - 10])
								.domain([0,maxValue[i]]);
						}
						d3.selectAll(".attr_button")
						.append("g")
						.data(AttrName)
						.append("button")
						.text(function(d,i){
							return AttrName[i]
						});
						
						d3.select("#AttrButton")
						.selectAll(".attr_button").remove();
						d3.select("#AttrButton")
						.selectAll(".attr_button")
						.append("g")
						.data(AttrName)
						.enter()
						.append("button")
						.attr("class","attr_button")
						.style("height",InRectYMin+"px")
						.style("width", (button_width) +"px")
						.on("click",function(d,i){
							sortAttr(d);
						})
						.text(function(d,i){
							return AttrName[i];
						});
						select_option.splice(0,select_option.length);
						for(var i=1;i<AttrName.length;i++){
							select_option[i-1] = AttrName[i];
						}
						//***********************************************
						d3.select("#multiple_select")
						.selectAll(".display_attr").remove();
						d3.select("#multiple_select")
						.selectAll(".display_attr")
						.append("g")
						.data(select_option)
						.enter()
						.append("option")
						.attr("selected","selected")
						.attr("class","display_attr")
						.attr("value", function(d){
							return d;
						})
						.text(function(d,i){
							return d;
						});
						$("select#multiple_select").multiselect('refresh');
						//*************************************************
						d3.select("#grouping_select")
						.selectAll(".sort_attr").remove();
						d3.select("#grouping_select")
						.selectAll(".sort_attr")
						.append("g")
						.data(select_option)
						.enter()
						.append("option")
						.attr("class","sort_attr")
						.attr("value",function(d){
							return d;
						})
						.text(function(d,i){
							return d;
						});
						$("select#grouping_select").multiselect('refresh');
						//**************************************************
						d3.select("#single_select")
						.selectAll(".color_option").remove();
						d3.select("#single_select")
						.selectAll(".color_option")
						.append("g")
						.data(filter_option)
						.enter()
						.append("option")
						.attr("class","color_option")
						.attr("value",function(d,i){
							return ColorArray[i];
						})
						.text(function(d,i){
							return d;
						});
						$("select#single_select").multiselect('refresh');
						sortIndex = 1;
						renderCSText();
						svg.selectAll("*").remove();
						tablelens();
					}
					reader.readAsText(file);	
				} else {
					alert("File not supported!");
				}
			});
	}
	//***********************************************************************************
	Array.min=function(array)
	{
    	return Math.min.apply(Math,array);
	}
	Array.max=function(array)
	{
    	return Math.max.apply(Math,array);
	}
	
	d3.select("#outer")
	//.style("margin-left", svgXMin+"px")
	.style("margin-top", svgYMin+"px")
	.style("height", (svgHeight + 55)+"px")
	.style("width", svgWidth+"px");
	
	d3.select("#color_control")
	.style("left", "0px")
	.style("top", InRectYMin + "px")
	.style("height", svgHeight+"px")
	.style("width", InRectXMin+"px");
	
	d3.select("#AttrButton")
	.style("left", "0px")
	.style("top", "0px")
	.style("margin-left",InRectXMin+"px")
	.style("height", InRectYMin+"px")
	.style("width", InRectWidth+"px");
	
	d3.select("#inner")
	.style("left", "0px")
	.style("top", "0px")
	.style("margin-left","0px")
	.style("height", InRectHeight+"px")
	.style("width", InRectWidth+"px");
	
	d3.select("#control_button")
	.style("left", "0px")
	.style("top", (InRectHeight + 160) + "px")
	.style("height", (80) +"px")
	.style("width", (InRectWidth - 320)+"px");
	
	computeButtonWidth();
	
	svg = d3.select("#inner")
	.append("svg")
	.attr("width",InRectWidth)
	.attr("height",InRectHeight);
	
	svg_color = d3.select("#color_control")
	.append("svg")
	.attr("width",InRectWidth/2)
	.attr("height",svgHeight);
	
	defs = svg_color.append("defs");
	linearGradient = defs.append("linearGradient")
						.attr("id","linearColor")
						.attr("x1","0%")
						.attr("y1","0%")
						.attr("x2","0%")
						.attr("y2","100%");
	for(var i=0;i<5;i++){
		stopArray[i] = linearGradient.append("stop")
				.attr("offset",stopNumArray[i]+"%")
				.style("stop-color",colorArray[i].toString());
	}
	
	svg_color.append("g")
	.attr("class","color_rect")
	.append("rect")
	.attr("x", InRectXMin - 45)
	.attr("y", InRectYMin)
	.attr("width", 30)
	.attr("height", InRectHeight)
	.style("fill","url(#" + linearGradient.attr("id") + ")");
	
	renderColor();
	computeColorRect();
	renderCSText();
	computeSelectRect();
	computeFilter();
	//****************************************************************
	//select focus by click or drag some area
	window.document.onmousedown = function(event){
		var begin_clickX = event.clientX;
		var begin_clickY = event.clientY;
		beginY = event.layerY - 120;
		RectBeginY = event.layerY;
		beginY_index = computeIndexY(RectBeginY);
		if((begin_clickX>focusXMin)&&(begin_clickX<focusXMax)&&(begin_clickY>focusYMin)&&(begin_clickY<focusYMax)){
			select_focus = true;
		}
		if((FirstSelectFilterNum!=-1)&&(begin_clickX<ColorXMax)&&(begin_clickX>ColorXMin)
			&&(begin_clickY<ColorYMax)&&(begin_clickY>ColorYMin)){
			moveFilter = true;
			moveSR = false;
			SelectFilterNum = FirstSelectFilterNum;
		}
		if((FirstSelectRectNum!=-1)&&(begin_clickX<ColorXMax)&&(begin_clickX>ColorXMin)
			&&(begin_clickY<ColorYMax)&&(begin_clickY>ColorYMin)){
			moveSR = true;
			moveFilter = false;
		}
	}
	window.document.onmousemove = function(event){
		var filter_moveY = event.layerY - 120;
		var cs_moveY = event.layerY - 120;
		if(moveSR){
			moveFilter = false;
			if(FirstSelectRectNum == 0){
				if(cs_moveY > cs_coord[1] - 15){
					cs_moveY = cs_coord[1] - 15;
				}
				if(cs_moveY<InRectYMin){
					cs_moveY = InRectYMin;
				}
			}else if(FirstSelectRectNum == (cs_coord.length - 1)){
				if(cs_moveY>InRectYMax){
					cs_moveY = InRectYMax;
				}
				if(cs_moveY<cs_coord[FirstSelectRectNum - 1] + 15){
					cs_moveY = cs_coord[FirstSelectRectNum - 1] + 15;
				}
			}else{
				if(cs_moveY > cs_coord[FirstSelectRectNum + 1] - 15){
					cs_moveY = cs_coord[FirstSelectRectNum + 1] - 15;
				}
				if(cs_moveY < cs_coord[FirstSelectRectNum - 1] + 15){
					cs_moveY = cs_coord[FirstSelectRectNum - 1] + 15;
				}
			}
			cs_coord[FirstSelectRectNum] = cs_moveY;
			svg_color.selectAll(".select_rect_text").remove();
			svg_color.selectAll(".select_rect_text")
			.append("g")
			.data(NamePArray)
			.enter()
			.append("text")
			.attr("class","select_rect_text")
			.attr("x",(InRectXMin - 23))
			.attr("y",function(d,i){
				return cs_coord[i]+5.5;
			})
			.attr("font-size",12)
			.attr("font-family","simsun")
			.text(function(d){
				return d;
			});
			svg_color.selectAll(".select_rect").remove();
			svg_color.selectAll(".select_rect")
			.append("g")
			.data(cs_array)
			.enter()
			.append("circle")
			.attr("class","select_rect")
			.attr("cx",(InRectXMin - 15))
			.attr("cy",function(d,i){
				return cs_coord[i];
			})
			.attr("r",10)
			.on("mouseover",function(d,i){
				d3.select(this)
				.attr("fill","orange");
				FirstSelectRectNum = i;
				FirstSelectFilterNum = -1;
			})
			.on("mouseout",function(d){
				d3.select(this)
				.attr("fill","gray");
			});
		}
		//**********************************************************
		if(moveFilter){
			moveSR = false;
			FocusArray.splice(0,FocusArray.length);
			yfocus_num = 0;
			if(FirstSelectFilterNum == 0){
				if(filter_moveY>filter_coord[1] - 15){
					filter_moveY = filter_coord[1] - 15;
				}
				if(filter_moveY<InRectYMin){
					filter_moveY = InRectYMin;
				}
			}else{
				if(filter_moveY>InRectYMax){
					filter_moveY = InRectYMax;
				}
				if(filter_moveY<filter_coord[0] + 15){
					filter_moveY = filter_coord[0] + 15;
				}
			}
			filter_coord[FirstSelectFilterNum] = filter_moveY;
			svg_color.selectAll(".filter_circle").remove();
			svg_color.selectAll(".filter_circle")
				.append("g")
				.data(filter_array)
				.enter()
				.append("circle")
				.attr("class","filter_circle")
				.attr("cx",(InRectXMin - 46))
				.attr("cy",function(d,i){
					return filter_coord[i];
				})
				.attr("r",8)
				.on("mouseover",function(d,i){
					d3.select(this)
					.attr("fill","orange");
					FirstSelectFilterNum = i;
					FirstSelectRectNum = -1;
				})
				.on("mouseout",function(d){
					d3.select(this)
					.attr("fill","gray");
				});
		}	
		//*************************************************************
		if(select_focus){
			var moveY = event.layerY - 120;
			RectMoveY = event.layerY;
			var beginSmall = true;
			svg.select(".focus_rect").remove();
			if((RectBeginY - RectMoveY)>0){
				svg.append("g")
				.attr("class","focus_rect")
				.append("rect")
				.attr("x",0)
				.attr("y",RectMoveY)
				.attr("height",(RectBeginY - RectMoveY))
				.attr("width",InRectWidth)
				.attr("fill-opacity",0.2)
				.attr("fill","gray")
				.attr("stroke","gray")
				.attr("stroke-width",1);
			}else{
				svg.append("g")
				.attr("class","focus_rect")
				.append("rect")
				.attr("x",0)
				.attr("y",RectBeginY)
				.attr("height",(RectMoveY - RectBeginY))
				.attr("width",InRectWidth)
				.attr("fill-opacity",0.2)
				.attr("fill","gray")
				.attr("stroke","gray")
				.attr("stroke-width",1);
			}
		}
	}
	window.document.onmouseup = function(event){
		var upY = event.layerY - 120;
		RectEndY = event.layerY;
		var filter_moveY = event.layerY - 120;
		var cs_moveY = event.layerY - 120;
		if(moveSR){
			moveFilter = false;
			if(FirstSelectRectNum == 0){
				if(cs_moveY > cs_coord[1] - 15){
					cs_moveY = cs_coord[1] - 15;
				}
				if(cs_moveY<InRectYMin){
					cs_moveY = InRectYMin;
				}
			}else if(FirstSelectRectNum == (cs_coord.length -1)){
				if(cs_moveY>InRectYMax){
					cs_moveY = InRectYMax;
				}
				if(cs_moveY<cs_coord[FirstSelectRectNum - 1] + 15){
					cs_moveY = cs_coord[FirstSelectRectNum - 1] + 15;
				}
			}else{
				if(cs_moveY > cs_coord[FirstSelectRectNum + 1] - 15){
					cs_moveY = cs_coord[FirstSelectRectNum + 1] - 15;
				}
				if(cs_moveY < cs_coord[FirstSelectRectNum - 1] + 15){
					cs_moveY = cs_coord[FirstSelectRectNum - 1] + 15;
				}
			}
			var point_num = Math.floor((InRectYMax - cs_moveY)/InRectHeight * 100);
			stopNumArray[(4 - FirstSelectRectNum)] = point_num;
			cs_array[(4 - FirstSelectRectNum)] = point_num/100;
			cs_coord[FirstSelectRectNum] = cs_moveY;
			renderCSText();
			renderColor();
			computeColorRect();
			computeFilter();
			computeSelectRect();
			moveSR = false;
			FirstSelectRectNum = -1;
		}
		//****************************************************************
		if(moveFilter){
			moveSR = false;
			FocusArray.splice(0,FocusArray.length);
			yfocus_num = 0;
			if(FirstSelectFilterNum == 0){
				if(filter_moveY>filter_coord[1] - 15){
					filter_moveY = filter_coord[1] - 15;
				}
				if(filter_moveY<InRectYMin){
					filter_moveY = InRectYMin;
				}
			}else{
				if(filter_moveY>InRectYMax){
					filter_moveY = InRectYMax;
				}
				if(filter_moveY<filter_coord[0] + 15){
					filter_moveY = filter_coord[0] + 15;
				}
			}
			filter_coord[FirstSelectFilterNum] = filter_moveY;
			if(FirstSelectFilterNum == 0){
					humannum_max = Math.floor((InRectHeight - filter_moveY + InRectYMin)/InRectHeight * humannum_sum);　			
			}else{
					humannum_min = Math.floor((InRectHeight - filter_moveY + InRectYMin)/InRectHeight * humannum_sum);
			}
			computeBarHeight();
			svg_color.selectAll(".filter_circle").remove();
			svg_color.selectAll(".filter_circle")
				.append("g")
				.data(filter_array)
				.enter()
				.append("circle")
				.attr("class","filter_circle")
				.attr("cx",(InRectXMin - 46))
				.attr("cy",function(d,i){
					return filter_coord[i];
				})
				.attr("r",8)
				.on("mouseover",function(d,i){
					d3.select(this)
					.attr("fill","orange");
					FirstSelectFilterNum = i;
					FirstSelectRectNum = -1;
				})
				.on("mouseout",function(d){
					d3.select(this)
					.attr("fill","gray");
				});
			moveFilter = false;
			FirstSelectFilterNum = -1;
		}
		//******************************************************************************
		var btnNum = event.button;
		if(btnNum == 0){
			if(currentYNum > 0){
				//*********************************
				var num = render_baseballdata[currentYNum].num;
				if(FocusArray.indexOf(num)==-1){
					FocusArray.push(num);
					yfocus_num++;
					if(focusY_max<0){
						focusY_max = currentYNum;
						focusY_min = currentYNum;
					}else{
						if(currentYNum>focusY_max){
							focusY_max = currentYNum;
						}
						if(currentYNum<focusY_min){
							focusY_min = currentYNum;
						}
					}
				}
				computeVarY();
		}	
		//******************************************************************************
		var up_clickY = event.clientY;
		if(up_clickY<30){
			beginY_index = -1;
		}
		upY_index = computeIndexY(RectEndY);
		if(select_focus){
			if((beginY_index<=upY_index)&&(beginY_index>=0)&&(upY_index - beginY_index)>3){
				for(var i=beginY_index;i<=upY_index;i++){
					var num = render_baseballdata[i].num;
					if(FocusArray.indexOf(num)==-1){
						FocusArray.push(num);
						yfocus_num++;
						if(focusY_max<0){
							focusY_max = i;
							focusY_min = i;
						}else{
							if(i>focusY_max){
								focusY_max = i;
							}else if(i < focusY_min){
								focusY_min = i;
							}
						}
					}
				}
			}else if((beginY_index>=0)&&((beginY_index - upY_index)>3)){
				for(var i=upY_index;i<=beginY_index;i++){
					var num = render_baseballdata[i].num;
					if(FocusArray.indexOf(num)!=-1){
						var n = FocusArray.indexOf(num);
						FocusArray.splice(n,1);
						yfocus_num--;
						if(i==focusY_max){
							focusY_max = i-1;
						}else if(i==focusY_min){
							focusY_min = i+1;
						}
					}
				}
			}
		}
		select_focus = false;
		svg.select(".focus_rect").remove();
		computeVarY();
		svg.selectAll("*").remove();
		tablelens();
	}
	//******************************************************
	window.document.onclick = function(event){
		total_event = event;
		svg.select(".focus_rect").remove();
		var btnNum = event.button;
		if(btnNum == 0){
			if(currentYNum > 0){
				//*********************************
				var num = render_baseballdata[currentYNum].num;
				if(FocusArray.indexOf(num)==-1){
					FocusArray.push(num);
					yfocus_num++;
					if(focusY_max<0){
						focusY_max = currentYNum;
						focusY_min = currentYNum;
					}else{
						if(currentYNum>focusY_max){
							focusY_max = currentYNum;
						}
						if(currentYNum<focusY_min){
							focusY_min = currentYNum;
						}
					}
				}
				computeVarY();
				svg.selectAll("*").remove();
				tablelens();
			}
		}
		//***********************************************
			select_focus = false;
			if(select_focus){
				var upY = event.layerY - 120;
				var upY_index = computeIndexY(upY);
				if(beginY_index <= upY_index ){
					for(var i=beginY_index;i<=upY_index;i++){
						var num = baseballdata[i].num;
						if(FocusArray.indexOf(num)==-1){
							FocusArray.push(num);
							yfocus_num++;
							if(focusY_max<0){
								focusY_max = i;
								focusY_min = i;
							}else{
								if(i>focusY_max){
									focusY_max = i;
								}else if(i < focusY_min){
									focusY_min = i;
								}
							}
						}
					}
				}else{
					for(var i=upY_index;i<=beginY_index;i++){
						var num = baseballdata[i].num;
						if(FocusArray.indexOf(num)!=-1){
							var n = FocusArray.indexOf(num);
							FocusArray.splice(n,1); 
							yfocus_num--;
							if(i==focusY_max){
								focusY_max = i-1;
							}else if(i==focusY_min){
								focusY_min = i+1;
							}
						}
					}
				}
				svg.select(".focus_rect").remove();
				computeVarY();
				svg.selectAll("*").remove();
				tablelens();
			}
		 }
	}
	//****************************************************************************
	function computeFilter(){
		svg_color.selectAll(".filter_circle").remove();
		svg_color.selectAll(".filter_circle")
		.append("g")
		.data(filter_array)
		.enter()
		.append("circle")
		.attr("class","filter_circle")
		.attr("cx",(InRectXMin - 46))
		.attr("cy",function(d,i){
			return filter_coord[i];
		})
		.attr("r",8)
		.on("mouseover",function(d,i){
			d3.select(this)
			.attr("fill","orange");
			FirstSelectFilterNum = i;
			FirstSelectRectNum = -1;
		})
		.on("mouseout",function(d){
			d3.select(this)
			.attr("fill","gray");
		});
	}
	//*************************************************************************
	function computeSelectRect(){
		svg_color.selectAll(".select_rect_text").remove();
		svg_color.selectAll(".select_rect_text")
		.append("g")
		.data(NamePArray)
		.enter()
		.append("text")
		.attr("class","select_rect_text")
		.attr("x",(InRectXMin - 23))
		.attr("y",function(d,i){
			return cs_coord[i]+5.5;
		})
		.attr("font-size",12)
		.attr("font-family","simsun")
		.text(function(d){
			return d;
		});
		//********************************************
		svg_color.selectAll(".select_rect").remove();
		svg_color.selectAll(".select_rect")
		.append("g")
		.data(cs_array)
		.enter()
		.append("circle")
		.attr("class","select_rect")
		.attr("cx",(InRectXMin - 15))
		.attr("cy",function(d,i){
			return cs_coord[i];
		})
		.attr("r",10)
		.on("mouseover",function(d,i){
			d3.select(this)
			.attr("fill","orange");
			FirstSelectRectNum = i;
			FirstSelectFilterNum = -1;
		})
		.on("mouseout",function(d){
			d3.select(this)
			.attr("fill","gray");
		});
	}
	//*******************************************************
	function computeButtonWidth(){
		button_width = ButtonInRectWidth/AttrNum;
		d3.select("#AttrButton")
		.selectAll(".attr_button").remove();
		d3.select("#AttrButton")
		.selectAll(".attr_button")
		.append("g")
		.data(SelectAttrName)
		.enter()
		.append("button")
		.attr("class","attr_button")
		.style("height",InRectYMin+"px")
		.style("width", button_width +"px")
		.on("click",function(d,i){
			sortAttr(d);
		})
		.text(function(d,i){
			return d;
		});
		
		for(var i=0;i<AttrAllNum;i++){
			XArray[i] = i * button_width;
		}
		for(var i=0;i<AttrAllNum;i++){
			ScaleArray[i] = d3.scale.linear()
				.range([0,button_width - 10])
				.domain([0,maxValue[i]]);
		}
		for(var i=0;i<AttrAllNum;i++){
			if(DisplayArray.indexOf(i)!=-1){
				d3.select("#"+ButtonArray[i])
				.style("height",tableMarginTopY+"px")
				.style("width",button_width +"px")
				.style("margin-left","-3px");
			}
		}
		for(var i=0;i<AttrAllNum;i++){
			if(DisplayArray.indexOf(i)==-1){
				d3.select("#"+ButtonArray[i])
				.style("display","none");
			}else{
				d3.select("#"+ButtonArray[i])
				.style("display","inline");
			}
		}
	}
	function computeBarHeight(){
		humannum = humannum_max - humannum_min;
		render_baseballdata = baseballdata.slice(humannum_min,humannum_max);
		focus_height = 20;
	}
	//rerender the color of the histogram and the rect
	function renderColor(){
			svg_color.select("defs").remove();
			svg_color.select("defs")
			.select("linearGradient")
			.remove();
			defs = svg_color.append("defs");
			linearGradient = defs.append("linearGradient")
						.attr("id","linearColor")
						.attr("x1","0%")
						.attr("y1","100%")
						.attr("x2","0%")
						.attr("y2","0%");
			for(var i=0;i<5;i++){
				stopArray[i] = linearGradient.append("stop")
				.attr("offset",stopNumArray[i]+"%")
				.style("stop-color",colorArray[4-i].toString());
			}
			for(var i=0;i<minValue.length;i++){
				var difference = Math.floor((maxValue[i] - minValue[i]));
				quarter0Value[i] = Math.floor(minValue[i] + difference * stopNumArray[0]/100);
				quarter1Value[i] = Math.floor(minValue[i] + difference * stopNumArray[1]/100);
				quarter2Value[i] = Math.floor(minValue[i] + difference * stopNumArray[2]/100);
				quarter3Value[i] = Math.floor(minValue[i] + difference * stopNumArray[3]/100);
				quarter4Value[i] = Math.floor(minValue[i] + difference * stopNumArray[4]/100);
			}
	}
	//*************************************************************************
	function computeColorRect(){
		svg_color.selectAll("rect").remove();
		svg_color.append("g")
		.attr("class","color_rect")
		.append("rect")
		.attr("x", InRectXMin - 45)
		.attr("y", InRectYMin)
		.attr("width", 30)
		.attr("height", InRectHeight)
		.style("fill","url(#" + linearGradient.attr("id") + ")");
	}
	//*************************************************************************
	function renderCSText(){
		for(var i=0;i<minValue.length;i++){
			var difference = Math.floor((maxValue[i] - minValue[i]));
			quarter0Value[i] = Math.floor(minValue[i] + difference * cs_array[0]);
			quarter1Value[i] = Math.floor(minValue[i] + difference * cs_array[1]);
			quarter2Value[i] = Math.floor(minValue[i] + difference * cs_array[2]);
			quarter3Value[i] = Math.floor(minValue[i] + difference * cs_array[3]);
			quarter4Value[i] = Math.floor(minValue[i] + difference * cs_array[4]);
		}
		NamePArray.splice(0,NamePArray.length);
		NamePArray.push(quarter4Value[sortIndex]+"");
		NamePArray.push(quarter3Value[sortIndex]+"");
		NamePArray.push(quarter2Value[sortIndex]+"");
		NamePArray.push(quarter1Value[sortIndex]+"");
		NamePArray.push(quarter0Value[sortIndex]+"");
		svg_color.selectAll(".select_rect_text").remove();
		svg_color.selectAll(".select_rect_text")
			.append("g")
			.data(NamePArray)
			.enter()
			.append("text")
			.attr("class","select_rect_text")
			.attr("x",(InRectXMin - 23))
			.attr("y",function(d,i){
				return cs_coord[i]+5.5;
			})
			.attr("font-size",12)
			.attr("font-family","simsun")
			.text(function(d){
				return d;
			});
	}
	//*************************************************************
	function computeVarY(){
		top_middleY = focusY_min * barheight;
		bottom_middleY = (focusY_max + 1 - yfocus_num) * barheight + yfocus_num * focus_height;
		ChangeRectHeight = yfocus_num * focus_height + (humannum_sum - yfocus_num)
		var coord_y = 0;
		YArray[0] = 0; 
		for(var i=1;i<render_baseballdata.length;i++){
			var num = render_baseballdata[i-1].num;
			if(FocusArray.indexOf(num)==-1){
				YArray[i] = YArray[i-1] + barheight;
			}else{
				YArray[i] = YArray[i-1] + focus_height;
			}
		}
	}
	function computeColor(value,index){
		var compute4 = d3.interpolate(a,b);
		var linear4 = d3.scale.linear()
				.domain([quarter4Value[index],quarter3Value[index]])
				.range([0,1]);
		var compute3 = d3.interpolate(b,c);
		var linear3 = d3.scale.linear()
				.domain([quarter3Value[index],quarter2Value[index]])
				.range([0,1]);
		var compute2 = d3.interpolate(c,d);
		var linear2 = d3.scale.linear()
				.domain([quarter2Value[index],quarter1Value[index]])
				.range([0,1]);
		var compute1 = d3.interpolate(d,e);
		var linear1 = d3.scale.linear()
				.domain([quarter1Value[index],quarter0Value[index]])
				.range([0,1]);
		if(value>=quarter4Value[index]){
			return a;
		}
		if((value>=quarter3Value[index])&&(value<=quarter4Value[index])){
			return compute4(linear4(value));
		}
		else if((value>quarter2Value[index])&&(value<=quarter3Value[index])){
			return compute3(linear3(value));
		}
		else if((value>quarter1Value[index])&&(value<=quarter2Value[index])){
			return compute2(linear2(value));
		}
		else if((value>quarter0Value[index])&&(value<=quarter1Value[index])){
			return compute1(linear1(value));
		}else{
			return e;
		}
	}
	function SortFunction(){
		if(sortIndex == 1){
			if(down_Bat86){
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return a.bat86 - b.bat86;
				});
				down_all = true;
			}else{
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return b.bat86 - a.bat86;
				});
				down_all = false;
			}
			computeMinMax();
			computeVarY();
		}else if(sortIndex == 2){
			if(down_Hit86){
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return a.hits86 - b.hits86;
				});
				down_all = true;
			}else{
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return b.hits86 - a.hits86;
				});
				down_all = false;
			}
			computeMinMax();
			computeVarY();
		}else if(sortIndex == 3){
			if(down_HRuns86){
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return a.hRuns86 - b.hRuns86;
				});
				down_all = true;
			}else{
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return b.hRuns86 - a.hRuns86;
				});
				down_all = false;
			}
			computeMinMax();
			computeVarY();
		}else if(sortIndex == 4){
			if(down_Runs86){
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return a.runs86 - b.runs86;
				});
				down_all = true;
			}else{
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return b.runs86 - a.runs86;
				});
				down_all = false;
			}
			computeMinMax();
			computeVarY();
		}else if(sortIndex == 5){
			if(down_Runbat86){
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return a.Runbat86 - b.Runbat86;
				});
				down_all = true;
			}else{
				render_baseballdata = render_baseballdata.sort(function(a,b){
					return b.Runbat86 - a.Runbat86;
				});
				down_all = false;
			}
			computeMinMax();
			computeVarY();
		}
	}
	//**************************************************************
	function tablelens(){
		//SortFunction();
		svg = d3.select("#inner")
		.select("svg")
		.attr("width",InRectWidth)
		.attr("height",ChangeRectHeight);
		var minCoordY = computeCoordY(humannum_min);
		var index = 0;
		var real_index = 1;
		var baseball_man = baseballdata[0];
		for(x in baseball_man){
			if(index > 0 && index < AttrAllNum){
				if(DisplayArray.indexOf(index)!=-1){
					var scale = ScaleArray[index];
					svg.selectAll(AttrArray[index])
					.data(render_baseballdata)
					.enter()
					.append("rect")
					.attr("x",function(d,i){
						return XArray[real_index];
					})
					.attr("y",function(d,i){				
						return YArray[i];
					})
					.attr("height",function(d,i){
						return DOIHeight(i);
					})
					.attr("width",function(d){
						return scale(d[x]);
					})
					.classed(AttrArray[index],true)
					.style("fill",function(d,i){
						var color = computeColor(getAttr(d,sortIndex),sortIndex);
						return  color;
					})
					.on("mouseover",function(d,i){
						currentYNum = i;
						d3.select(this).style("fill","green");
					})
					.on("mouseout",function(d){
						currentYNum = -1;
						var color = computeColor(getAttr(d,sortIndex),sortIndex);
						d3.select(this).style("fill",function(){
							return color;
						});
					});
					real_index++;
				}
			}
			index++;
		}
		//*********************************************************
		for(var i=0;i<FocusArray.length;i++){
			var indexY = computeRealIndexY(FocusArray[i]);
			var focusx_top = computeCoordY(indexY);
			var focusx_bottom = focusx_top + focus_height;
			svg.append("g")
			.append("line")
			.attr("x1",0)
			.attr("x2",InRectWidth)
			.attr("y1",focusx_top)
			.attr("y2",focusx_top)
			.attr("stroke","gray")
			.attr("stroke-width",1);
		//*************************************************
			svg.append("g")
			.append("line")
			.attr("x1",0)
			.attr("x2",InRectWidth)
			.attr("y1",focusx_bottom)
			.attr("y2",focusx_bottom)
			.attr("stroke","gray")
			.attr("stroke-width",1);
		//*************************************************
			var baseballman = render_baseballdata[indexY];
			var index = 0;
			var real_index = 0;
			var font_size = Math.floor(130/AttrNum);
			if(font_size>18){
				font_size = 18;
			}
			for(x in baseballman){
				if(DisplayArray.indexOf(index)!=-1){
					var attr = baseballman[x];
					svg.append("g")
					.append("text")
					.attr("x",(XArray[real_index] + text_paddingX))
					.attr("y",focusx_bottom - text_paddingY)
					.attr("class","person")
					.attr("font-size",font_size)
					.attr("font-family","simsun")
					.text(baseballman[x]);
					real_index++;
				}
				index++;
			}
		}
	}
	//*****************************************************************
	//get the attribute of the baseball man according to the index
	function getAttr(baseballman, focus_index){
		var index = 0;
		var attr;
		for(x in baseballman){
			if(index==focus_index){
				attr = baseballman[x];
				break;
			}
			index++;
		}
		return attr;
	}
	function computeRealIndexY(lastAttrY){
		var indexY = 0;
		for(var i=0;i<render_baseballdata.length;i++){
			if(lastAttrY == render_baseballdata[i].num){
				indexY = i;
				break;
			}
		}
		return indexY;
	}
	//**********************************************************
	function computeCoordYAll(indexY){
		var minY = computeCoordY(humannum_min);
		var coordY = computeCoordY(indexY + humannum_min);
		return coordY - minY;
	}
	function computeCoordY(indexY){
		var coordY = 0;
		if(yfocus_num == 0){
			coordY = indexY * barheight;
		}else if(indexY <= focusY_min){
			coordY = indexY * barheight;
		}else if(indexY <= focusY_max){
			var temp_coordY = top_middleY;
			for(var i=focusY_min;i<focusY_max;i++){
				var num = render_baseballdata[i].num;
				if(FocusArray.indexOf(num)==-1){
					temp_coordY = temp_coordY + barheight;
				}else{
					temp_coordY = temp_coordY + focus_height;
				}
				if(i == (indexY - 1)){
					coordY = temp_coordY;
					break;
				}
			}
		}else{
			coordY = bottom_middleY + (indexY - focusY_max - 1) * barheight;
		}
		return coordY;
	}
	//**********************************************************
	function computeIndexY(CoordY){
		var IndexY = 0;
		if(yfocus_num == 0){
			IndexY = Math.floor(CoordY/barheight);
		}else if(CoordY<=top_middleY){
			IndexY = Math.floor(CoordY/barheight);
		}else if(CoordY<=bottom_middleY){
			var temp_y = top_middleY;
			var belong_index = 0;
			for(var i=focusY_min;i<=focusY_max;i++){
				var num = render_baseballdata[i].num;
				if(FocusArray.indexOf(num)==-1){
					if((CoordY>=temp_y)&&(CoordY<=(temp_y+barheight))){
						belong_index = i;
						break;
					}else{
						temp_y = temp_y + barheight;
					}
				}else{
					if((CoordY>=temp_y)&&(CoordY<=(temp_y+focus_height))){
						belong_index = i;
						break;
					}else{
						temp_y = temp_y + focus_height;
					}
				}
			}
			IndexY = belong_index;
		}else{
			IndexY = Math.ceil((CoordY - bottom_middleY)/barheight) + focusY_max;
		}
		return IndexY;
	}
	//**********************************************************
	function DOIHeight(index){
		//not the original data
		var doi_height = 0;
		var num = render_baseballdata[index].num;
		if(FocusArray.indexOf(num)!=-1){
			//click location
			doi_height = focus_height;
		}else{
			doi_height = barheight;
		}
		return doi_height;
	};
	//***********************************************************
	function sortAttr(attr_name){
		if(SortObject[attr_name]){
			render_baseballdata = render_baseballdata.sort(function(a,b){
				return a[attr_name] - b[attr_name];
			});
			SortObject[attr_name] = false;
			down_all = true;
		}else{
			render_baseballdata = render_baseballdata.sort(function(a,b){
				return b[attr_name] - a[attr_name];
			});
			SortObject[attr_name] = true;
			down_all = false;
		}
		for(var i=0;i<AttrNum;i++){
			if(attr_name==AttrName[i]){
				sortIndex = i;
				break;
			}
		}
		computeMinMax();
		computeVarY();
		svg.selectAll("*").remove(); 
		tablelens();
	}
	function computeMinMax(){
		 focusY_min = humannum_sum;
		 focusY_max = -1;
		 for(var i=humannum_min;i<humannum_max;i++){
		 	var num = render_baseballdata[i].num;
			if(FocusArray.indexOf(num)!=-1){
				if(i<focusY_min){
					focusY_min = i;
				}
				if(i>focusY_max){
					focusY_max = i;
				}
			}
		 }
	}
	//************************************************************
	//reset the data seleted
	function resetSelection(){
		FocusArray.splice(0,FocusArray.length);
		yfocus_num = 0;
		focusY_min = -1;
		focusY_max = -1;
		computeVarY();
		svg.selectAll("*").remove();
		tablelens();
	}
	//remove the data seleted
	function removeSelected(){
		for(var i=0;i<render_baseballdata.length;i++){
			if(FocusArray.indexOf(render_baseballdata[i].num)!=-1){
				render_baseballdata.splice(i,1);
				i--;
			}
		}
		FocusArray.splice(0,FocusArray.length);
		yfocus_num = 0;
		focusY_min = -1;
		focusY_max = -1;
		computeVarY();
		svg.selectAll("*").remove();
		tablelens();
	}
	//remove other data
	function removeOthers(){
		for(var i=0;i<render_baseballdata.length;i++){
			if(FocusArray.indexOf(render_baseballdata[i].num)==-1){
				render_baseballdata.splice(i,1);
				i--;
			}
		}
		FocusArray.splice(0,FocusArray.length);
		yfocus_num = 0;
		focusY_min = -1;
		focusY_max = -1;
		computeVarY();
		svg.selectAll("*").remove();
		tablelens();
	}
	//remove filters
	function resetfilter(){
		render_baseballdata = baseballdata.concat();
		FocusArray.splice(0,FocusArray.length);
		yfocus_num = 0;
		focusY_min = -1;
		focusY_max = -1;
		computeVarY();
		humannum_min = 0;
		humannum_max = humannum_sum;
		svg.selectAll("*").remove();
		tablelens();
	}
	//change the AttrNum
	function ChangeAttr(numChecked,checkedItems){
		AttrNum = numChecked + 1;
		DisplayArray = new Array();
		SelectAttrName = new Array();
		DisplayArray.push(0);
		for(var i=0;i<checkedItems.length;i++){
			for(var j=0;j<AttrAllNum;j++){
				if(checkedItems[i].value == AttrName[j]){
					DisplayArray.push(j);
				}
			}
			if(checkedItems[i].value.substring(0,(checkedItems[i].value.length-1))
			 == AttrName[AttrAllNum - 1].substring(0,AttrName[AttrAllNum-1].length-1)){
			 	DisplayArray.push(AttrAllNum - 1);
			 }
		}
		for(var i=0;i<DisplayArray.length;i++){
			SelectAttrName.push(AttrName[DisplayArray[i]]);
		}
		computeButtonWidth();
		svg.selectAll("*").remove();
		tablelens();
	}
	//change the sort num
	function ChangeSort(checkedItems){
		for(var j=0;j<AttrAllNum;j++){
			if(checkedItems[0].value == AttrName[j]){
				sortIndex = j;
			}
		}
		if(checkedItems[0].value.substring(0,(checkedItems[0].value.length-1))
		    == AttrName[AttrAllNum - 1].substring(0,AttrName[AttrAllNum-1].length-1)){
			sortIndex = AttrAllNum - 1;
		}
		svg.selectAll("*").remove();
		tablelens();
	}
	//change the color
	function ChangeColor(checkedItems){
		if(checkedItems[0].value=="uniformly5"){
			cs_array[0] = 0.17;
			cs_array[1] = 0.33;
			cs_array[2] = 0.50;
			cs_array[3] = 0.66;
			cs_array[4] = 0.83;
			for(var i=0;i<cs_array.length;i++){
				cs_coord[i] = InRectYMin + cs_array[i]* InRectHeight;
			}
			for(var i=0;i<cs_array.length;i++){
				stopNumArray[i] = cs_array[i] * 100;
			}
			renderCSText();
			renderColor();
			computeColorRect();
			computeFilter();
			computeSelectRect();
			svg.selectAll("*").remove();
			tablelens();
		}else if(checkedItems[0].value=="uniformly4"){
			cs_array[0] = 0.00;
			cs_array[1] = 0.20;
			cs_array[2] = 0.40;
			cs_array[3] = 0.60;
			cs_array[4] = 0.80;
			for(var i=0;i<cs_array.length;i++){
				cs_coord[i] = InRectYMin + cs_array[i]* InRectHeight;
			}
			for(var i=0;i<cs_array.length;i++){
				stopNumArray[i] = cs_array[i] * 100;
			}
			renderCSText();
			renderColor();
			computeColorRect();
			computeFilter();
			computeSelectRect();
			svg.selectAll("*").remove();
			tablelens();
		}else if(checkedItems[0].value=="uniformly3"){
			cs_array[0] = 0.00;
			cs_array[1] = 0.25;
			cs_array[2] = 0.50;
			cs_array[3] = 0.75;
			cs_array[4] = 1.00;
			for(var i=0;i<cs_array.length;i++){
				cs_coord[i] = InRectYMin + cs_array[i] * InRectHeight;
			}
			for(var i=0;i<cs_array.length;i++){
				stopNumArray[i] = cs_array[i] * 100;
			}
			renderCSText();
			renderColor();
			computeColorRect();
			computeFilter();
			computeSelectRect();
			svg.selectAll("*").remove();
			tablelens();
		}else if(checkedItems[0].value=="percentile1"){
			var index1 = Math.floor(render_baseballdata.length * 0.1);
			var index2 = Math.floor(render_baseballdata.length * 0.5);
			var index3 = Math.floor(render_baseballdata.length * 0.9);
			cs_array[0] = 0.00;
			cs_array[1] = (getAttr(render_baseballdata[index1],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[2] = (getAttr(render_baseballdata[index2],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[3] = (getAttr(render_baseballdata[index3],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[4] = 1.00;
			for(var i=0;i<cs_array.length;i++){
				cs_coord[i] = InRectYMin + Math.floor(cs_array[i] * InRectHeight);
			}
			for(var i=0;i<cs_array.length;i++){
				stopNumArray[i] = Math.floor(cs_array[i] * 100);
			}
			renderColor();
			computeColorRect();
			renderCSText();
			computeFilter();
			computeSelectRect();
			svg.selectAll("*").remove();
			tablelens();
		}else if(checkedItems[0].value=="percentile2"){
			var index1 = Math.floor(render_baseballdata.length * 0.3);
			var index2 = Math.floor(render_baseballdata.length * 0.6);
			var index3 = Math.floor(render_baseballdata.length * 0.9);
			cs_array[0] = 0.00;
			cs_array[1] = (getAttr(render_baseballdata[index1],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[2] = (getAttr(render_baseballdata[index2],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[3] = (getAttr(render_baseballdata[index3],sortIndex) - minValue[sortIndex])/(maxValue[sortIndex] - minValue[sortIndex]);
			cs_array[4] = 1.00;
			for(var i=0;i<cs_array.length;i++){
				cs_coord[i] = InRectYMin + Math.floor(cs_array[i] * InRectHeight);
			}
			for(var i=0;i<cs_array.length;i++){
				stopNumArray[i] = Math.floor(cs_array[i] * 100);
			}
			renderColor();
			computeColorRect();
			renderCSText();
			computeFilter();
			computeSelectRect();
			svg.selectAll("*").remove();
			tablelens();
		}
	}
</script>
</html>
